import{f as p}from"./fetch-DEkoyLsj.js";async function E(){const o="https://hyte-servu.northeurope.cloudapp.azure.com/api/auth/me",n={method:"GET",headers:{Authorization:"Bearer "+localStorage.getItem("token")}};try{const e=await fetch(o,n);if(!e.ok)throw new Error("Failed to fetch user data. Status: "+e.status);const r=await e.json();if(!r.user||!r.user.user_id)throw new Error("Invalid response format. User ID not found.");return r.user.user_id}catch(e){return console.error("Error fetching user ID:",e.message),null}}const k=document.querySelector(".get_users");k.addEventListener("click",g);async function g(){console.log("Haetaan kaikki entriet");const o="https://hyte-servu.northeurope.cloudapp.azure.com/api/entries",n={method:"GET",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};p(o,n).then(e=>{console.log(e),S(e)})}function S(o){const t=document.querySelector(".tbody");t.innerHTML="",o.forEach(n=>{const e=document.createElement("tr"),r=document.createElement("td");r.innerText=y(n.entry_date),e.appendChild(r);const a=document.createElement("td");a.innerText=n.mood,e.appendChild(a);const c=document.createElement("td");c.innerText=n.sleep_hours+" h",e.appendChild(c);const s=document.createElement("td"),d=document.createElement("button");d.className="check",d.innerText="Notes",d.addEventListener("click",function(){const h=n.notes;C(h)}),s.appendChild(d),e.appendChild(s);const i=document.createElement("td"),l=document.createElement("button");l.className="del",l.dataset.id=n.entry_id,l.textContent="Delete",i.appendChild(l),l.addEventListener("click",I);const u=document.createElement("td");u.innerText=n.entry_id,e.appendChild(i),e.appendChild(u),t.appendChild(e)})}function y(o){const t=new Date(o),n=t.getDate().toString().padStart(2,"0"),e=(t.getMonth()+1).toString().padStart(2,"0"),r=t.getFullYear();return`${n}.${e}.${r}`}function C(o){const t=document.getElementById("notesDialog"),n=document.getElementById("header"),e=document.getElementById("dialogText");n.innerHTML="";const r=document.createElement("h4");r.textContent="Notes: ",e.innerText=o,n.appendChild(r),t.showModal()}document.getElementById("closeNotes").addEventListener("click",function(){document.getElementById("notesDialog").close()});function I(o){console.log("klikkasit delete nappulaa",o);const t=o.target.attributes["data-id"].value;o.target.parentElement.nextElementSibling.textContent;const n="https://hyte-servu.northeurope.cloudapp.azure.com/api/entries",r={method:"DELETE",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};confirm("Oletko varma, että haluat poistaa entryn: "+t)&&p(n,r).then(c=>{console.log(c),g()})}const T=document.querySelector(".creatediary");T.addEventListener("click",async o=>{o.preventDefault(),console.log("Nyt luodaan Diary entry");const t=document.querySelector(".addform");if(!t.checkValidity()){t.reportValidity();return}const n=t.querySelector("input[name=entry_date]").value,e=t.querySelector("select[name=mood]").value,r=t.querySelector("input[name=weight]").value,a=t.querySelector("input[name=sleep_hours]").value,c=t.querySelector("textarea[name=notes]").value,s=await E();console.log(s),document.querySelector(".clearform").addEventListener("click",function(m){m.preventDefault();const f=getElementById("clearbutton");f.textContent=""});const i="https://hyte-servu.northeurope.cloudapp.azure.com/api/entries";let l=localStorage.getItem("token");const u={user_id:s,entry_date:n,mood:e,weight:r,sleep_hours:a,notes:c};console.log(u);const h={method:"POST",headers:{Authorization:"Bearer: "+l,"Content-Type":"application/json"},body:JSON.stringify(u)};p(i,h).then(m=>{console.log(m),g(),t.reset(),alert("Tallennus onnistui!")}).catch(m=>{console.error("Error:",m),alert("Täytä kaikki kentät!")})});async function v(){console.log("Täällä ollaan!");const o="https://hyte-servu.northeurope.cloudapp.azure.com/api/auth/me",n={method:"GET",headers:{Authorization:"Bearer: "+localStorage.getItem("token")}};p(o,n).then(e=>{document.getElementById("name").innerHTML=e.user.username})}document.querySelector(".user_info").addEventListener("click",x);async function x(){const o="https://hyte-servu.northeurope.cloudapp.azure.com/api/auth/me",n={method:"GET",headers:{Authorization:"Bearer "+localStorage.getItem("token")}};p(o,n).then(e=>{console.log(e);const r=y(e.user.created_at),a=e.user.username,c=e.user.email,s=e.user.user_level;B(r,a,c,s)}).catch(e=>{console.error("Error:",e)})}function B(o,t,n,e){const r=document.getElementById("information"),a=document.getElementById("userinfo");a.innerHTML="";const c=document.createElement("h4"),s=document.createElement("p"),d=document.createElement("p"),i=document.createElement("p"),l=document.createElement("p");c.textContent="User information: ",s.textContent="User created: "+o,d.textContent="Username: "+t,i.textContent="Email: "+n,l.textContent="User level: "+e,a.appendChild(c),a.appendChild(s),a.appendChild(d),a.appendChild(i),a.appendChild(l),r.showModal()}document.getElementById("closeInfo").addEventListener("click",function(){document.getElementById("information").close()});document.querySelector(".logout").addEventListener("click",D);function D(o){o.preventDefault(),localStorage.removeItem("token"),console.log("logginout"),window.location.href="index.html"}v();
